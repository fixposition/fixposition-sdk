name: fixposition-sdk

services:

    # ----- ROS1 -------------------------------------------------------------------------------------------------------

    ros1-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros1-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros1-base
    ros1-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros1-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros1-ci
        depends_on:
            - ros1-base
    ros1-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros1-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros1-dev
        depends_on:
            - ros1-base
        volumes:
            # Bash config
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            # Persistent history
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            # Workspace
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE # Set kernel.yama.ptrace_scope = 0 in /etc/sysctl.d/10-ptrace.conf
        hostname: fpsdk-ros1-dev-${USER}
        # Apparently required... (so that the container doesn't kill itself?)
        command: tail -f

    # ----- ROS2 -------------------------------------------------------------------------------------------------------

    ros2-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros2-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros2-base
    ros2-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros2-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros2-ci
        depends_on:
            - ros2-base
    ros2-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:ros2-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.ros2-dev
        depends_on:
            - ros2-base
        volumes:
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE
        hostname: fpsdk-ros2-dev-${USER}
        command: tail -f

    # ------------------------------------------------------------------------------------------------------------------

    # Non-ROS base image based on Debian
    deb-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:deb-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.deb-base
    deb-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:deb-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.deb-ci
        depends_on:
            - deb-base
    deb-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:deb-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.deb-dev
        depends_on:
            - deb-base
        volumes:
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE
        hostname: fpsdk-deb-dev-${USER}
        command: tail -f
