name: fixposition-sdk

services:

    # ----- ROS1 -------------------------------------------------------------------------------------------------------

    noetic-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:noetic-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.noetic-base
    noetic-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:noetic-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.noetic-ci
        depends_on:
            - noetic-base
    noetic-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:noetic-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.noetic-dev
        depends_on:
            - noetic-base
        volumes:
            # Bash config
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            # Persistent history
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            # Workspace
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE # Set kernel.yama.ptrace_scope = 0 in /etc/sysctl.d/10-ptrace.conf
        hostname: fpsdk-noetic-dev-${USER}
        # Apparently required... (so that the container doesn't kill itself?)
        command: tail -f

    # ----- ROS2 -------------------------------------------------------------------------------------------------------

    humble-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:humble-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.humble-base
    humble-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:humble-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.humble-ci
        depends_on:
            - humble-base
    humble-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:humble-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.humble-dev
        depends_on:
            - humble-base
        volumes:
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE
        hostname: fpsdk-humble-dev-${USER}
        command: tail -f

    jazzy-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:jazzy-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.jazzy-base
    jazzy-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:jazzy-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.jazzy-ci
        depends_on:
            - jazzy-base
    jazzy-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:jazzy-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.jazzy-dev
        depends_on:
            - jazzy-base
        volumes:
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE
        hostname: fpsdk-jazzy-dev-${USER}
        command: tail -f

    # ------------------------------------------------------------------------------------------------------------------

    # Non-ROS base image based on Debian
    bookworm-base:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:bookworm-base
        build:
            context: ..
            dockerfile: docker/Dockerfile.bookworm-base
    bookworm-ci:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:bookworm-ci
        build:
            context: ..
            dockerfile: docker/Dockerfile.bookworm-ci
        depends_on:
            - bookworm-base
    bookworm-dev:
        image: ghcr.io/fixposition/fixposition/fixposition-sdk:bookworm-dev
        build:
            context: ..
            dockerfile: docker/Dockerfile.bookworm-dev
        depends_on:
            - bookworm-base
        volumes:
            - ../.devcontainer/.bashrc:/home/fpsdk/.bashrc
            - ../.devcontainer/.bash_logout:/home/fpsdk/.bash_logout
            - ../.devcontainer/.bash_history.d:/home/fpsdk/.bash_history.d
            - ../.:/home/fpsdk/fixposition_utility
        cap_add:
          - SYS_PTRACE
        hostname: fpsdk-bookworm-dev-${USER}
        command: tail -f
